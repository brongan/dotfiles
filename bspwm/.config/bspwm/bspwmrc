#!/usr/bin/env bash

MONITORS=( $(xrandr --query -display ${DISPLAY} | grep " connected " | awk '{ print$1 }' | tr '\n' ' ') )
PRIMARY_MONITOR_RESOLUTION=xrandr --current |awk '$0 ~ "*" {print $1}' | head -n 1

# If we have an internal monitor with 4k rez make it 1080p
if [[  "${MONITORS[0]}" == "eDP-1" && $PRIMARY_MONITOR_RESOLUTION=="3840x2160" ]]; then
	xrandr --output "${MONITORS[0]}" --mode "1920x1080"
fi

if [[ ${#MONITORS[@]} -eq 1 ]]; then
	bspc monitor "${MONITORS[0]}" -d I II III IV V
	bspc rule -a Caprine desktop=^3
	bspc rule -a discord desktop=^3
	bspc rule -a Nightly desktop=^2
	bspc rule -a Google-chrome desktop=^2
elif  [[ ${#MONITORS[@]} -eq 2 ]]; then
	bspc monitor "${MONITORS[0]}" -d I II III 
	bspc monitor "${MONITORS[1]}" -d IV V VI
	bspc rule -a Caprine desktop=^4
	bspc rule -a discord desktop=^4
else
    # TODO Detach laptop monitor
	bspc monitor "${MONITORS[0]}" -d VII 
	bspc monitor "${MONITORS[1]}" -d I II III
	bspc monitor "${MONITORS[2]}" -d IV V VI
	bspc rule -a Caprine desktop=^6
	bspc rule -a discord desktop=^6
fi

# border color
# bspc config normal_border_color "$(get_xrdb background)"
# bspc config focused_border_color "$(get_xrdb color12)"
bspc config border_width		  3
bspc config window_gap			  12
bspc config split_ratio			  0.50
bspc config borderless_monocle	  true
bspc config gapless_monocle		  true
bspc config single_monocle		  true

bspc config split_ratio			 0.52
bspc config borderless_monocle	 true
bspc config gapless_monocle		 true

bspc rule -a Rofi state=floating
bspc rule -a Peek state=floating
bspc rule -a Zathura state=tiled
bspc rule -a firefox state=tiled
bspc rule -a Nightly state=tiled

# pointer
xsetroot -cursor_name left_ptr

steamlib=~/Games/SteamLibrary 
if [[ -d $steamlib ]]; then
	mygames=$(ls $steamlib/steamapps/appmanifest_*.acf | sed 's/[^0-9]*//g')
	for game in $mygames; do
		bspc rule -a steam_app_$game desktop=^2 state=fullscreen
	done
fi

hsetroot -fill ~/Desktop/CyberneticBackground.jpg

kitty &
if	command -v "firefox-nightly" &> /dev/null; then
	firefox-nightly &
else
	google-chrome &
fi

if command -v "caprine" &> /dev/null; then
	caprine &
fi
if command -v "discord" &> /dev/null; then
	discord &
fi

if ! systemctl --user cat xorg.target 2&> /dev/null; then
	sxhkd &
	picom &
	dunst &
	launch_polybar.sh
fi

